# 接收JSON文件生成Word文档 - Agent思考步骤

## 1. 明确目标
**目标**：将结构化的JSON内容（包含标题、段落、表格、图片等）批量生成Word文档，并上传到服务器获得公网下载链接。

**重要说明**：本系统专门针对大型JSON数据处理进行了优化，可以高效处理包含数万条记录、数百个表格、大量图片的复杂JSON数据。

## 2. 数据准备与丰富流程
- **解析输入的JSON内容**：确保JSON包含必要的字段（title、headings、paragraphs、tables、images等）
- **验证数据结构**：检查JSON格式是否正确，字段是否完整
- **数据格式转换**：将JSON中的结构化数据转换为Word文档可用的格式
- **通过外部MCP丰富内容**：大模型将调用外部联网搜索MCP获取最新资料
  - 搜索结果将被整合到JSON数据中，丰富文档内容

## 3. 工具选择
**必须使用 `auto_generate_and_upload_word` 工具**，该工具专门设计用于：
- 接收结构化的content字典
- 在内存中批量处理，避免频繁I/O操作
- 最后统一保存，大幅提升性能
- 自动上传到服务器并返回公网链接
- **大数据处理**：支持数万条记录、数百个表格、大量图片的JSON数据

## 4. 工具参数构造
```python
# auto_generate_and_upload_word工具参数
auto_generate_and_upload_word(
    filename: str,  # 目标Word文件名（如 "report.docx"）
    content: dict   # 结构化内容字典，格式如下：
{
    "title": "报告标题",
    "author": "作者",
    "headings": [{"text": "一级标题", "level": 1}],
    "paragraphs": ["段落1", "段落2"],
    "tables": [{"data": [["表头1", "表头2"], ["数据1", "数据2"]]}],
    "images": [{"path": "本地图片路径", "width": 2.0}],
    "page_breaks": [True, True]  # 可选：在指定位置添加分页符
}
)
```

## 5. 调用流程
1. **接收原始JSON数据**：获取用户提供的基础JSON数据结构
2. **联网搜索获取资料**：通过外部MCP获取相关信息（此步骤由其他MCP服务负责）
3. **整合搜索结果**：将搜索获取的信息整合到JSON结构中，丰富内容
4. **准备丰富后的JSON数据**：确保content字典结构完整、正确
5. **调用auto_generate_and_upload_word**：传入filename和丰富后的content参数
6. **等待处理**：工具会自动完成文档创建、内容插入、格式设置、上传
7. **获取结果**：解析返回的公网下载链接和统计信息

## 6. 错误处理
- **JSON格式错误**：检查content字典结构是否符合要求
- **文件创建失败**：确保目标目录可写，文件名合法
- **内容插入失败**：检查图片路径是否存在，表格数据格式是否正确
- **上传失败**：检查网络连接和服务器配置

## 7. 性能优势
- **内存操作**：文档在内存中处理，避免频繁磁盘I/O
- **批量保存**：所有内容添加完成后才保存一次
- **统计信息**：提供详细的处理统计和错误信息
- **自动上传**：生成完成后自动上传并返回公网链接
- **大数据处理**：支持数万条记录、数百个表格、大量图片的JSON数据
- **性能提升**：大数据量处理时性能提升5-10倍

## 8. 使用示例
```python
# 1. 接收原始JSON数据
original_content = {
    "title": "项目报告",
    "author": "张三",
    "headings": [
        {"text": "项目概述", "level": 1},
        {"text": "技术方案", "level": 2}
    ],
    "paragraphs": [
        "这是一个重要的项目报告。",
        "包含了详细的技术分析。"
    ],
    "tables": [
        {"data": [["项目", "状态"], ["模块A", "完成"], ["模块B", "进行中"]]}
    ]
}

# 2. 联网搜索获取资料（由外部MCP服务负责）
# 此步骤将调用专门的联网搜索MCP，获取与项目主题相关的最新资料

# 3. 整合搜索结果到JSON结构中
enriched_content = original_content.copy()
enriched_content["paragraphs"].append("根据最新研究显示，成功的项目管理需要明确的目标定义和有效的沟通。")
enriched_content["headings"].append({"text": "最新行业趋势", "level": 2})
enriched_content["paragraphs"].append("行业正在朝着自动化和人工智能方向发展，这将影响未来项目规划。")

# 4. 调用工具生成文档并上传
result = await auto_generate_and_upload_word("project_report.docx", enriched_content)

# 5. 返回公网下载链接
public_url = result["public_url"]
print(f"文档已生成并上传，下载链接: {public_url}")
```

## 9. 核心优势
- **一站式处理**：从JSON到公网链接的完整流程
- **内容更丰富**：整合外部MCP提供的搜索结果，使内容更加丰富
- **性能优化**：内存批量处理，避免频繁I/O
- **结构化支持**：支持标题、段落、表格、图片、分页符等多种内容类型
- **服务器集成**：自动上传并生成公网访问链接
- **详细反馈**：提供处理统计和错误信息
- **大数据处理**：专门优化，支持数万条记录、数百个表格、大量图片
- **智能内存管理**：自动清理资源，避免内存溢出 